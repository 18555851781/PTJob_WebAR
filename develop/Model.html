<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <title>
        Model
    </title>
    <script src="../three.js/examples/vendor/three.js/build/three.js"></script>
    <script src="../three.js/examples/vendor/three.js/examples/js/loaders/GLTFLoader.js"></script>
    <script src="../three.js/examples/vendor/three.js/examples/js/controls/OrbitControls.js"></script>
    <script src="../three.js/examples/vendor/three.js/examples/js/loaders/OBJLoader.js"></script>
    <script src="../three.js/examples/vendor/three.js/examples/js/loaders/MTLLoader.js"></script>

    <style>
        *{
            padding: 0;
            margin: 0;
        }
        .Text{
            position: fixed;
            width: 70%;
            left: 0%;
            bottom: 0%;
            font-size: 0.5rem;
            margin: 5px;
            z-index: 1000;
        }
        .Mask{
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: white;
        }
        .Load{
            position: fixed;
            top: 50%;
            left: 50%;
            width: 15rem;
            height: 22rem;
            transform: translate(-50%,-50%);
        }
        .BLG_img
        {
            position: fixed;
            bottom:0%;
            right: 0%;
            width: 6.5rem;
            height: 5rem;
        }
        #Tag1,#Tag2,#Tag3,#Tag4,#Tag5,#Tag6{
            position: absolute;
            background-color: skyblue;
            width: 50px;
            height: 25px;
            text-align: center;
            border-radius: 10px;
            display: none;
            line-height: 25px;
            font-size: 0.5rem;
        }
        .div_Input{
            position: absolute;
            width: 25%;
            height: 120px;
            right: 0%;
            bottom: 0%;
            z-index: 1000;
        }

        .ControlModel{
            position: absolute;
            text-align: center;
            height: 1.5rem;
            width: 45%;
            top: 10%;
            right: 5%;
            border-radius: 2px;
            background-color: skyblue;
        }
        .DisplayTag{
            position: absolute;
            text-align: center;
            height: 1.5rem;
            width: 45%;
            top: 10%;
            left: 1%;
            border-radius: 2px;
            background-color: skyblue;
        }

    </style>
</head>
<body>
    <div class="UI_Body">
        <div class="UI">
            <div class="TagUI">
                <div id="Tag1"></div>
                <div id="Tag2"></div>
                <div id="Tag3"></div>
                <div id="Tag4"></div>
                <div id="Tag5"></div>
                <div id="Tag6"></div>
            </div>
            <div class="div_Input">
                <input type="button" class="ControlModel"  onclick="MoveControl()" value="分离">
                <input type="button" class="DisplayTag" onclick="TagControl()" value="介绍">
                <img src="../Model/Texture/WechatIMG129.png" class="BLG_img">
            </div>
            <div>
                <p class="Text">拨浪鼓是一种古老又传统的民间乐器和玩具，出现于战国时期。拨浪鼓的主体是一面小鼓，两侧缀有两枚弹丸，鼓下有柄，转动鼓柄弹丸击鼓发出声音。鼓身可以是木的也可以是竹的，还有泥的、硬纸的；鼓面用羊皮、牛皮、蛇皮或纸制成，其中以木身羊皮面的拨浪鼓最为典型。</p>
            </div>
            <div id="Mask" class="Mask">
                <img src="../Model/Texture/BLG.jpg" class="Load">
            </div>
        </div>
        <div class="Display">
            <script>

                //  外部进行Bool值切换  使按钮按下后移动阀值改变
                var IsGetObj,IsMove,IsTagDisplay = false;

                function MoveControl()
                {
                    IsMove = !IsMove;
                }

                function TagControl()
                {
                    IsTagDisplay = !IsTagDisplay;
                    if(IsTagDisplay)
                    {
                        TagDisplay();
                    }else
                    {
                        TagNotDisplay();
                    }
                }

                //  标签显示
                function TagDisplay()
                {
                    var Mytag1 = document.getElementById("Tag1");
                    Mytag1.style.display = "block";
                    var Mytag2 = document.getElementById("Tag2");
                    Mytag2.style.display = "block";
                    var Mytag3 = document.getElementById("Tag3");
                    Mytag3.style.display = "block";
                    var Mytag4 = document.getElementById("Tag4");
                    Mytag4.style.display = "block";
                    var Mytag5 = document.getElementById("Tag5");
                    Mytag5.style.display = "block";
                    var Mytag6 = document.getElementById("Tag6");
                    Mytag6.style.display = "block";
                }

                //  标签取消显示
                function TagNotDisplay()
                {
                    var Mytag1 = document.getElementById("Tag1");
                    Mytag1.style.display = "none";
                    var Mytag2 = document.getElementById("Tag2");
                    Mytag2.style.display = "none";
                    var Mytag3 = document.getElementById("Tag3");
                    Mytag3.style.display = "none";
                    var Mytag4 = document.getElementById("Tag4");
                    Mytag4.style.display = "none";
                    var Mytag5 = document.getElementById("Tag5");
                    Mytag5.style.display = "none";
                    var Mytag6 = document.getElementById("Tag6");
                    Mytag6.style.display = "none";
                }

                function init()
                {
                    var OBJ_GuBin,OBj_GuSheng,OBj_HouGuMian,OBj_QianGuMian,OBj_YouGuChui,OBj_ZuoGuChui;


                    var scene = new THREE.Scene();

                    var camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
                    camera.position.z = 30;
                    camera.lookAt(scene.position);

                    var pointlight = new THREE.PointLight(0xffffff,2);
                    pointlight.position.set(-30,30,-30);
                    scene.add(pointlight);

                    var pointlight_2 = new THREE.PointLight(0xffffff,2);
                    pointlight_2.position.set(-30,30,30);
                    scene.add(pointlight_2);

                    var pointlight_3 = new THREE.PointLight(0xffffff,2);
                    pointlight_3.position.set(30,0,0);
                    scene.add(pointlight_3);

                    var renderer = new THREE.WebGLRenderer();
                    renderer.setSize(window.innerWidth,window.innerHeight);
                    renderer.setClearColor(new THREE.Color(0xffffff),1.0);
                    // renderer.setSize(500,500);
                    //  重要！！！将元素渲染到html元素上 否则不显示
                    document.body.appendChild(renderer.domElement);

                    var control = new THREE.OrbitControls(camera,renderer.domElement);
                    control.autoRotate = true;
                    control.maxDistance = 30;
                    control.enablePan = false;
                    control.minDistance = 30;

                    //  不显示加载图片
                    function LoadDisplay()
                    {
                        var Mask = document.getElementById("Mask");
                        Mask.style.display = "none";
                    }

                    //  禁止下拉刷新
                    function NoPull() {
                        document.body.addEventListener('touchmove',(e)=>
                            {e.preventDefault();},
                            {passive : false}
                        )
                    }
                    NoPull();


                    //  加载模型并初始化
                    function Load()
                    {
                        var loader_1 = new THREE.MTLLoader();
                        loader_1.setPath('../Model/OBJ/');
                        loader_1.setTexturePath('../Model/OBJ/');
                        loader_1.load('BLG_GuSheng.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var Loadobj = new THREE.OBJLoader();
                            Loadobj.setMaterials(material);
                            Loadobj.setPath('../Model/OBJ/');
                            Loadobj.load('BLG_GuSheng.obj',function (obj) {

                                obj.name = "GuSheng";
                                OBj_GuSheng = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBj_GuSheng);
                                scene.add(obj);
                            });
                        })

                        var loader_2 = new THREE.MTLLoader();
                        loader_2.setPath('../Model/OBJ/');
                        loader_2.setTexturePath('../Model/OBJ/');
                        loader_2.load('BLG_GuBin.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var Loadobj = new THREE.OBJLoader();
                            Loadobj.setMaterials(material);
                            Loadobj.setPath('../Model/OBJ/');
                            Loadobj.load('BLG_GuBin.obj',function (obj) {

                                obj.scale.y = 0.7;
                                obj.name = "GuBin";
                                OBJ_GuBin = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBJ_GuBin);
                                scene.add(obj);
                            })
                        })

                        var loader_3 = new THREE.MTLLoader();
                        loader_3.setPath('../Model/OBJ/');
                        loader_3.setTexturePath('../Model/OBJ/');
                        loader_3.load('BLG_HouGuMian.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var loadobj = new THREE.OBJLoader();
                            loadobj.setMaterials(material);
                            loadobj.setPath('../Model/OBJ/');
                            loadobj.load('BLG_HouGuMian.obj',function (obj) {

                                obj.position.y = 5.4;
                                obj.position.z = -2;
                                obj.name = "HouGuMian";
                                OBj_HouGuMian = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBj_HouGuMian);
                                scene.add(obj);
                            })
                        })

                        var loader_4 = new THREE.MTLLoader();
                        loader_4.setPath('../Model/OBJ/');
                        loader_4.setTexturePath('../Model/OBJ/');
                        loader_4.load('BLG_QianGuMian.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var loadobj = new THREE.OBJLoader();
                            loadobj.setMaterials(material);
                            loadobj.setPath('../Model/OBJ/');
                            loadobj.load('BLG_QianGuMian.obj',function (obj) {

                                obj.position.y = 5.4;
                                obj.position.z = 2;
                                obj.name = "QianGuMian";
                                OBj_QianGuMian = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBj_QianGuMian);
                                scene.add(obj);
                            })
                        })

                        var loader_5 = new THREE.MTLLoader();
                        loader_5.setPath('../Model/OBJ/');
                        loader_5.setTexturePath('../Model/OBJ/');
                        loader_5.load('BLG_ZuoGuChui.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var loadobj = new THREE.OBJLoader();
                            loadobj.setMaterials(material);
                            loadobj.setPath('../Model/OBJ/');
                            loadobj.load('BLG_ZuoGuChui.obj',function (obj) {

                                obj.position.x = -5.7;
                                obj.position.y = 5.4;
                                obj.position.z = 0.05;
                                obj.name = "ZuoGuChui";
                                OBj_ZuoGuChui = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBj_ZuoGuChui);
                                scene.add(obj);
                            })
                        })

                        var loader_6 = new THREE.MTLLoader();
                        loader_6.setPath('../Model/OBJ/');
                        loader_6.setTexturePath('../Model/OBJ/');
                        loader_6.load('BLG_YouGuChui.mtl',function (material) {
                            //  预加载
                            material.preload();

                            var loadobj = new THREE.OBJLoader();
                            loadobj.setMaterials(material);
                            loadobj.setPath('../Model/OBJ/');
                            loadobj.load('BLG_YouGuChui.obj',function (obj) {

                                obj.position.z = 0.3;
                                obj.position.y = 5.4;
                                obj.name = "YouGuChui";
                                OBj_YouGuChui = obj;
                                console.log(obj);
                                //OBJ_Group.add(OBj_YouGuChui);
                                scene.add(obj);
                            })
                        })
                    }
                    Load();

                    //  对模型进行操作
                    function ControlModel_Boom(model)
                    {
                        //  数值向外移动0.5就可以看到明显差距
                        if(model.name == "GuBin" && model.position.y >= -3)
                        {
                            model.position.y-=0.1;
                        }
                        if(model.name == "HouGuMian" && model.position.z >=-5)
                        {
                            model.position.z-=0.1;
                        }
                        if(model.name == "QianGuMian" && model.position.z <=5)
                        {
                            model.position.z += 0.1;
                        }
                        if(model.name == "ZuoGuChui" && model.position.x >=-8.7)
                        {
                            model.position.x -= 0.1;
                        }
                        if(model.name == "YouGuChui" && model.position.x <=3)
                        {
                            model.position.x += 0.1;
                        }
                    }

                    function ControlModel_Back(model)
                    {
                        if(model.name == "GuBin" && model.position.y <= 0)
                        {
                            model.position.y+=0.1;
                        }
                        if(model.name == "HouGuMian" && model.position.z <=-2)
                        {
                            model.position.z+=0.1;
                        }
                        if(model.name == "QianGuMian" && model.position.z >=2)
                        {
                            model.position.z -= 0.1;
                        }
                        if(model.name == "ZuoGuChui" && model.position.x <=-5.7)
                        {
                            model.position.x += 0.1;
                        }
                        if(model.name == "YouGuChui" && model.position.x >= 0)
                        {
                            model.position.x -= 0.1;
                        }
                    }

                    //  标签跟随物体进行移动
                    function TagControl(obj,x,y,z,tag,text)
                    {

                        var worldVec3 = new THREE.Vector3(x,y,z);
                        var canvasVec2 = worldVec3.project(camera);
                        var a = window.innerWidth / 2;
                        var b = window.innerHeight / 2;
                        var x_canvas = Math.round(canvasVec2.x * a + a);
                        var y_canvas = Math.round(-canvasVec2.y * b + b);

                        var objtag = document.getElementById(tag);
                        objtag.innerHTML = text;
                        objtag.style.left = x_canvas  + "px";
                        objtag.style.top = y_canvas  + "px";
                    }

                    //  标签实时刷新
                    function TagMove()
                    {
                        if(IsGetObj)
                        {
                            TagControl(OBJ_GuBin,OBJ_GuBin.position.x-1,OBJ_GuBin.position.y-10,OBJ_GuBin.position.z,"Tag1","鼓柄");
                            TagControl(OBj_GuSheng,OBj_GuSheng.position.x-1,OBj_GuSheng.position.y+13,OBj_GuSheng.position.z-1,"Tag2","鼓身");
                            TagControl(OBj_QianGuMian,OBj_QianGuMian.position.x,OBj_QianGuMian.position.y,OBj_QianGuMian.position.z+2,"Tag3","前鼓面");
                            TagControl(OBj_HouGuMian,OBj_HouGuMian.position.x,OBj_HouGuMian.position.y,OBj_HouGuMian.position.z-4,"Tag4","后鼓面");
                            TagControl(OBj_YouGuChui,OBj_YouGuChui.position.x+8,OBj_YouGuChui.position.y-5,OBj_YouGuChui.position.z+3,"Tag5","右鼓槌");
                            TagControl(OBj_ZuoGuChui,OBj_ZuoGuChui.position.x-5,OBj_ZuoGuChui.position.y-5,OBj_ZuoGuChui.position.z-3,"Tag6","左鼓槌");
                        }
                    }

                    //  第一帧的时候获取不到 必须要重复获取才可以
                    //  获取模型并对其进行操作
                    function Move()
                    {
                        if(OBJ_GuBin !== undefined && OBj_YouGuChui !== undefined && OBj_ZuoGuChui !== undefined && OBj_QianGuMian !== undefined && OBj_HouGuMian !== undefined && OBj_GuSheng!== undefined && !IsGetObj)
                        {
                            IsGetObj = true;

                            LoadDisplay();
                        }
                        if(IsGetObj && IsMove)
                        {
                            ControlModel_Boom(OBJ_GuBin);
                            ControlModel_Boom(OBj_YouGuChui);
                            ControlModel_Boom(OBj_ZuoGuChui);
                            ControlModel_Boom(OBj_QianGuMian);
                            ControlModel_Boom(OBj_HouGuMian);
                        }
                        else if(IsGetObj && !IsMove)
                        {
                            ControlModel_Back(OBJ_GuBin);
                            ControlModel_Back(OBj_QianGuMian);
                            ControlModel_Back(OBj_HouGuMian);
                            ControlModel_Back(OBj_YouGuChui);
                            ControlModel_Back(OBj_ZuoGuChui);
                            // TagNotDisplay("Tag1","Tag2","Tag3","Tag4","Tag5","Tag6");
                        }

                    }
                    setInterval(Move,10);

                    //  渲染
                    function render()
                    {
                        requestAnimationFrame(TagMove);
                        requestAnimationFrame(render);
                        renderer.render(scene,camera);
                    }
                    render();
                }
                window.onload = init;

            </script>
        </div>
    </div>
</body>
</html>